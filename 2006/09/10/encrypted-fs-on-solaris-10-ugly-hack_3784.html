<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Blog Title - Encrypted FS on Solaris 10, Ugly Hack</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body>

    <div id="main" role="main">
      <p>This is an off the cuff solution to encrypted file systems on Solaris 10 in
response to <a href="http://blogs.sun.com/davidleetodd/entry/opensolaris_adventures">OpenSolaris
Adventures</a>
which mentions concerns about file security given physical access to a device.</p>

<p>Until zfs has crypto support or encrypted lofi is available, you could set a
bios password. Or create your own loopback file based fs. Of course if the
file is decrypted and the attacker steals your laptop you are out of luck. So
only having the decrypted data in /tmp would offer some protection.</p>

<p>The poor man's version would be something like:</p>

<p>1) Make a source file (Preferably in /tmp)</p>

<p>2) Create a Loopback</p>

<p>3) Layout a filesystem</p>

<p>4) Add content</p>

<p>5) Encrypt (To not /tmp)</p>

<p>6) Delete source file</p>

<p>Ongoing Usage scripted as:</p>

<p>1) decrypt /var/tmp/encrypted.current to /tmp/decrypted</p>

<p>2) create lofi and mount</p>

<p>3) encrypt to /var/tmp/encrypted.new</p>

<p>4) delete decrypted file</p>

<p>5) Move encrypted.current to .bak and new to .current</p>

<p><strong>Steps 1 - 4:</strong></p>

<blockquote>

  <p>t2000-10# mkfile 10m /tmp/foo</p>

  <p>t2000-10# lofiadm -a /tmp/foo</p>

  <p>/dev/lofi/1</p>

  <p>t2000-10# newfs /dev/lofi/1</p>

  <p>newfs: construct a new file system /dev/rlofi/1: (y/n)? y</p>

  <p>/dev/rlofi/1: 20468 sectors in 34 cylinders of 1 tracks, 602 sectors</p>

  <p>10.0MB in 3 cyl groups (16 c/g, 4.70MB/g, 2240 i/g)</p>

  <p>t2000-10# mkdir /tmp/foo_mnt</p>

  <p>t2000-10# mount /dev/lofi/1 /tmp/foo_mnt</p>

  <table>
    <tbody>
      <tr>
        <td>t2000-10# cat /usr/man/man1/*</td>
        <td>nroff -man &gt; /tmp/foo_mnt/important.txt</td>
      </tr>
    </tbody>
  </table>

</blockquote>

<p><strong>Content is visible to the casual viewer:</strong></p>

<table>
  <tbody>
    <tr>
      <td>t2000-10# cat /tmp/foo</td>
      <td>strings</td>
      <td>head -100</td>
    </tr>
  </tbody>
</table>

<p>…</p>

<p>Moi2</p>

<p>a subcommand and no arguments is</p>

<p>an error. This guideline is provided to allow the</p>

<p>common forms command –</p>

<p>p, command -?</p>

<p>?, command</p>

<p>--</p>

<p>n, and command -V</p>

<p>V to be accepted in the</p>

<p>command-subcommand construct.</p>

<p>Several of these guidelines are only of interest to the</p>

<p>authors of utilities. They are provided here for the use of</p>

<p>t2000-10# umount /tmp/foo_mnt</p>

<p>t2000-10# lofiadm -d /dev/lofi/1</p>

<p><strong>Step 5:</strong></p>

<blockquote>

  <p>t2000-10# time encrypt -a 3des -v -i /tmp/foo -o /var/tmp/3des_encrypted</p>

  <p>Enter key:</p>

  <table>
    <tbody>
      <tr>
        <td>[………………</td>
        <td>……………….</td>
        <td>……………….</td>
        <td>……………….]</td>
      </tr>
    </tbody>
  </table>

  <p>Done.</p>

  <p>encrypt -a 3des -v -i /tmp/foo -o /var/tmp/3des_encrypted 4.44s user 0.63s
system 60% cpu 8.434 total</p>

  <p>t2000-10# rm /tmp/foo</p>

</blockquote>

<p><strong>Simple check to see if data is still accessible:</strong></p>

<blockquote>

  <p>t2000-10# lofiadm -a /var/tmp/3des_encrypted</p>

  <p>lofiadm: size of /var/tmp/3des_encrypted is not a multiple of 512</p>

  <p>t2000-10# file /var/tmp/3des_encrypted</p>

  <p>/var/tmp/3des_encrypted: data</p>

  <table>
    <tbody>
      <tr>
        <td>t2000-10# cat /var/tmp/3des_encrypted</td>
        <td>strings</td>
      </tr>
    </tbody>
  </table>

  <p>…</p>

</blockquote>

<p><strong>Accessing Encrypted Data:</strong></p>

<blockquote>

  <p>t2000-10# decrypt -v -a 3des -i /var/tmp/3des_encrypted -o /tmp/decrypted_fs</p>

  <p>Enter key:</p>

  <table>
    <tbody>
      <tr>
        <td>[………………</td>
        <td>……………….</td>
        <td>……………….</td>
        <td>………………]</td>
      </tr>
    </tbody>
  </table>

  <p>Done.</p>

  <table>
    <tbody>
      <tr>
        <td>t2000-10# cat /tmp/decrypted_fs</td>
        <td>strings</td>
        <td>head -100</td>
      </tr>
    </tbody>
  </table>

  <p>…</p>

  <p>VkQP</p>

  <p>a subcommand and no arguments is</p>

  <p>an error. This guideline is provided to allow the</p>

  <p>common forms command –</p>

  <p>p, command -?</p>

  <p>?, command</p>

  <p>--</p>

  <p>n, and command -V</p>

  <p>V to be accepted in the</p>

  <p>command-subcommand construct.</p>

  <p>Several of these guidelines are only of interest to the</p>

  <p>authors of utilities. They are provided here for the use of</p>

  <p>t2000-10# lofiadm -a /tmp/decrypted_fs</p>

  <p>/dev/lofi/1</p>

  <p>t2000-10# mount /dev/lofi/1 /tmp/foo_mnt</p>

</blockquote>

<p><strong>Checking Contents:</strong></p>

<blockquote>

  <p>t2000-10# cd /tmp/foo_mnt</p>

  <p>t2000-10# head important.txt</p>

  <p>User Commands Intro(1)</p>

  <p>NAME</p>

  <p>Intro, intro - introduction to commands and application pro-</p>

  <p>grams</p>

</blockquote>


    </div>

    <aside>
      <h2>Recent Articles</h2>
      <ol>
          <li><a href="/2016/09/25/a-very-soft-relaunch.html">A very soft relaunch</a> <span>Sep 25</span></li>
          <li><a href="/2011/07/27/looking-for-new-trail-shoes.html">Looking for new (trail) shoes</a> <span>Jul 27</span></li>
          <li><a href="/2011/07/27/gunpowder-50k.html">Gunpowder 50k</a> <span>Jul 27</span></li>
          <li><a href="/2011/01/02/winterclassic-2011.html">WinterClassic 2011</a> <span>Jan  2</span></li>
          <li><a href="/2010/11/28/mcm-race-report-or-example-of-poor.html">MCM Race Report or An Example of Poor Execution</a> <span>Nov 28</span></li>
          <li><a href="/2010/11/26/army-10-miler.html">Army 10 Miler</a> <span>Nov 26</span></li>
          <li><a href="/2010/11/09/potomac-heritage-50k.html">Potomac Heritage 50K</a> <span>Nov  9</span></li>
          <li><a href="/2010/10/21/10th-baltimore-marathon-race-report.html">10th Baltimore Marathon Race Report</a> <span>Oct 21</span></li>
          <li><a href="/2010/09/29/day-hike-on-at.html">Day Hike on the AT</a> <span>Sep 29</span></li>
          <li><a href="/2010/09/29/caps-vs-bruins-pre-season.html">Caps vs Bruins Pre-Season</a> <span>Sep 29</span></li>
      </ol>

      <h2>Tags</h2>
      <ol>
          <li><a href="/tags/yakshaving.html">yakshaving (130)</a></li>
          <li><a href="/tags/b-s-c.html">b.s.c. (241)</a></li>
          <li><a href="/tags/apple.html">apple (9)</a></li>
          <li><a href="/tags/solaris.html">solaris (33)</a></li>
          <li><a href="/tags/boring-n-healthy.html">boring N healthy (16)</a></li>
          <li><a href="/tags/grid.html">grid (3)</a></li>
          <li><a href="/tags/zones.html">zones (1)</a></li>
          <li><a href="/tags/solaris10.html">solaris10 (1)</a></li>
          <li><a href="/tags/lame.html">lame (6)</a></li>
          <li><a href="/tags/opensolaris.html">opensolaris (11)</a></li>
          <li><a href="/tags/bittorrent.html">BitTorrent (1)</a></li>
          <li><a href="/tags/photography.html">photography (1)</a></li>
          <li><a href="/tags/svn.html">SVN (2)</a></li>
          <li><a href="/tags/scm.html">SCM (2)</a></li>
          <li><a href="/tags/cvs.html">CVS (2)</a></li>
          <li><a href="/tags/svk.html">SVK (2)</a></li>
          <li><a href="/tags/cec-2006.html">CEC 2006 (28)</a></li>
          <li><a href="/tags/sun.html">Sun (32)</a></li>
          <li><a href="/tags/security.html">Security (5)</a></li>
          <li><a href="/tags/encryption.html">Encryption (1)</a></li>
          <li><a href="/tags/sun-cec.html">Sun CEC (44)</a></li>
          <li><a href="/tags/dtrace.html">Dtrace (1)</a></li>
          <li><a href="/tags/rbac.html">RBAC (1)</a></li>
          <li><a href="/tags/spam.html">spam (1)</a></li>
          <li><a href="/tags/education.html">Education (3)</a></li>
          <li><a href="/tags/sungrid.html">SunGrid (2)</a></li>
          <li><a href="/tags/puppy.html">puppy (1)</a></li>
          <li><a href="/tags/web2-0.html">web2.0 (4)</a></li>
          <li><a href="/tags/secondlife.html">secondlife (3)</a></li>
          <li><a href="/tags/paranoia.html">Paranoia (2)</a></li>
          <li><a href="/tags/sunmicrosystems.html">SunMicrosystems (1)</a></li>
          <li><a href="/tags/cec-2007.html">CEC 2007 (22)</a></li>
          <li><a href="/tags/indiana.html">indiana (1)</a></li>
          <li><a href="/tags/olpc.html">olpc (4)</a></li>
          <li><a href="/tags/x11.html">X11 (1)</a></li>
          <li><a href="/tags/howto.html">howto (6)</a></li>
          <li><a href="/tags/leopard.html">Leopard (5)</a></li>
          <li><a href="/tags/sgd.html">sgd (1)</a></li>
          <li><a href="/tags/tiger.html">Tiger (1)</a></li>
          <li><a href="/tags/sge.html">SGE (3)</a></li>
          <li><a href="/tags/n1ge.html">N1GE (2)</a></li>
          <li><a href="/tags/zfs.html">ZFS (6)</a></li>
          <li><a href="/tags/hockey.html">Hockey (3)</a></li>
          <li><a href="/tags/storage.html">storage (3)</a></li>
          <li><a href="/tags/food.html">food (5)</a></li>
          <li><a href="/tags/race.html">race (14)</a></li>
          <li><a href="/tags/running.html">running (23)</a></li>
          <li><a href="/tags/photo.html">photo (16)</a></li>
          <li><a href="/tags/baltimore.html">baltimore (5)</a></li>
          <li><a href="/tags/family.html">family (1)</a></li>
          <li><a href="/tags/theater.html">theater (1)</a></li>
          <li><a href="/tags/vacation.html">vacation (1)</a></li>
          <li><a href="/tags/china.html">china (1)</a></li>
          <li><a href="/tags/video.html">video (4)</a></li>
          <li><a href="/tags/untitled.html">Untitled (4)</a></li>
          <li><a href="/tags/humor.html">humor (2)</a></li>
          <li><a href="/tags/twitter.html">twitter (2)</a></li>
          <li><a href="/tags/games.html">games (1)</a></li>
          <li><a href="/tags/blender.html">blender (1)</a></li>
          <li><a href="/tags/movie.html">Movie (1)</a></li>
          <li><a href="/tags/rendering.html">rendering (1)</a></li>
          <li><a href="/tags/oss.html">OSS (3)</a></li>
          <li><a href="/tags/crosug.html">CROSUG (1)</a></li>
          <li><a href="/tags/marathon.html">marathon (4)</a></li>
          <li><a href="/tags/gooosegrade.html">gooosegrade (1)</a></li>
          <li><a href="/tags/computing.html">computing (1)</a></li>
          <li><a href="/tags/cloud.html">cloud (1)</a></li>
          <li><a href="/tags/performance.html">performance (2)</a></li>
          <li><a href="/tags/netbeans.html">NetBeans (1)</a></li>
          <li><a href="/tags/java.html">java (1)</a></li>
          <li><a href="/tags/fud.html">FUD (1)</a></li>
          <li><a href="/tags/hiking.html">hiking (2)</a></li>
          <li><a href="/tags/fail.html">fail (1)</a></li>
          <li><a href="/tags/maryland.html">Maryland (1)</a></li>
          <li><a href="/tags/tnfec.html">TNFEC (2)</a></li>
          <li><a href="/tags/aarc.html">AARC (2)</a></li>
          <li><a href="/tags/trail.html">trail (1)</a></li>
          <li><a href="/tags/burn.html">Burn (1)</a></li>
          <li><a href="/tags/wickerman.html">WickerMan (1)</a></li>
          <li><a href="/tags/work.html">work (1)</a></li>
          <li><a href="/tags/bruins.html">Bruins (1)</a></li>
          <li><a href="/tags/capitals.html">Capitals (1)</a></li>
          <li><a href="/tags/ultra.html">ultra (2)</a></li>
          <li><a href="/tags/fatass.html">fatass (2)</a></li>
          <li><a href="/tags/vhtrc.html">vhtrc (1)</a></li>
          <li><a href="/tags/pittsburgh.html">Pittsburgh (1)</a></li>
      </ol>

      <h2>By Year</h2>
      <ol>
          <li><a href="/2016.html">2016 (1)</a></li>
          <li><a href="/2011.html">2011 (3)</a></li>
          <li><a href="/2010.html">2010 (21)</a></li>
          <li><a href="/2009.html">2009 (2)</a></li>
          <li><a href="/2008.html">2008 (27)</a></li>
          <li><a href="/2007.html">2007 (56)</a></li>
          <li><a href="/2006.html">2006 (61)</a></li>
          <li><a href="/2005.html">2005 (95)</a></li>
      </ol>
    </aside>
  </body>
</html>
